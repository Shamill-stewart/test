(Get-WmiObject -Class Win32_UserAccount | Select-Object @{N='Type';E={'User'}}, Name, FullName, Disabled, PasswordRequired, @{N='Port';E={$null}}, @{N='ProcessName';E={$null}}, @{N='ProcessId';E={$null}}, @{N='CPU';E={$null}}, @{N='Memory';E={$null}}) + (Get-NetTCPConnection | Where-Object {$_.State -eq 'Listen'} | Select-Object @{N='Type';E={'Port'}}, @{N='Name';E={$null}}, @{N='FullName';E={$null}}, @{N='Disabled';E={$null}}, @{N='PasswordRequired';E={$null}}, @{N='Port';E={$_.LocalPort}}, @{N='ProcessName';E={(Get-Process -Id $_.OwningProcess).ProcessName}}, @{N='ProcessId';E={$_.OwningProcess}}, @{N='CPU';E={(Get-Process -Id $_.OwningProcess).CPU}}, @{N='Memory';E={(Get-Process -Id $_.OwningProcess).WorkingSet}}) + (Get-Process | Select-Object @{N='Type';E={'Process'}}, @{N='Name';E={$null}}, @{N='FullName';E={$null}}, @{N='Disabled';E={$null}}, @{N='PasswordRequired';E={$null}}, @{N='Port';E={$null}}, ProcessName, @{N='ProcessId';E={$_.Id}}, CPU, @{N='Memory';E={$_.WorkingSet}}) | Export-Csv -Path ([System.IO.Path]::Combine([Environment]::GetFolderPath("ApplicationData"), "SystemInfo.csv")) -NoTypeInformation
